---
- name:       check if ServerDesity Agent is installed
  stat:
    path:     "{{ serverdensity_agent_conf }}"
  register:   serverdensity_agent_conf_status

- set_fact:
    serverdensity_is_installed: "{{ (serverdensity_agent_conf_status.stat.isreg is defined and serverdensity_agent_conf_status.stat.isreg) }}"

- debug:
    msg: "ServerDesity Agent was successfully installed on the box"
  when: serverdensity_is_installed

- debug:
    msg: "The Devices {{devices_with_same_agent_key.json.0.name}} has been properly registered with the ID {{devices_with_same_agent_key.json.0._id}} in ServerDesity"
  when:  devices_with_same_agent_key.json

- assert:
    that:
      - serverdensity_is_installed
      - devices_with_same_agent_key.json
    msg: "ServerDesity Agent was NOT successfully installed on the box or wasn't registered on ServerDesity"

...
